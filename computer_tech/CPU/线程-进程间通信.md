1、线程
1.1、线程的基本概念
线程是进程中执行运算的最小单位，是被系统独立调度和分派的基本单位，线程自己不拥有系统资源，只拥有一点在运行中必不可少的资源，但它可与同属一个进程的其它线程共享进程所拥有的全部资源。一个线程可以创建和撤消另一个线程，同一进程中的多个线程之间可以并发执行。

1.2、使用线程的好处
（1）易于调度；
（2）多线程可提高并发性：通过线程可方便有效地实现并发性，进程可创建多个线程来执行同一程序的不同部分；
（3）开销少：创建线程比创建进程要快，所需开销很少；
（4）有利于充分发挥多处理器的功能：通过创建多线程进程，每个线程在一个处理器上运行，从而实现应用程序的并发性，使每个处理器都得到充分运用。

2、线程间的通信方式
1、使用全局变量
由于属于同一个进程的各个线程共享操作系统分配给该进程的资源，故解决线程间通信最简单的一种方法是使用全局变量。对于标准类型的全局变量，我们建议使用volatile 修饰符，它告诉编译器无需对该变量作任何的优化，即无需将它放到一个寄存器中，并且该值可被外部改变。如果线程间所需传递的信息较复杂，我们可以定义一个结构，通过传递指向该结构的指针进行传递信息。

2、使用消息（消息队列）实现通信
在Windows程序设计中，每一个线程都可以拥有自己的消息队列（UI线程默认自带消息队列和消息循环，工作线程需要手动实现消息循环），因此可以采用消息进行线程间通信sendMessage,postMessage。

3、使用事件CEvent类实现线程间通信
Event对象有两种状态：有信号和无信号，线程可以监视处于有信号状态的事件，以便在适当的时候执行对事件的操作。

3、线程间的同步方式
3.1、同步和互斥的关系
各个线程可以访问进程中的公共变量，资源，所以使用多线程的过程中需要注意的问题是如何防止两个或两个以上的线程同时访问同一个数据，以免破坏数据的完整性。数据之间的相互制约包括：

1、直接制约关系（同步关系）———同步是指散布在不同进程之间的若干程序片段（线程），它们的运行必须严格按照规定的某种先后次序来运行，以实现访问者对资源或者数据的有序访问；即：一个线程的执行依赖另一个线程的消息，当它没有得到另一个线程的消息时应等待，直到消息到达时才被唤醒，因此线程之间直接制约着，这种关系可以称之为同步关系；

2、间接制约关系（互斥关系）——互斥是指散布在不同进程之间的若干程序片断（线程），当某个进程运行其中一个程序片段时，其它进程就不能运行它们之中的任一程序片段，只能等到该进程运行完这个程序片段后才可以运行。如果某一资源或数据是互斥的，则同时只允许一个访问者对其进行访问，具有唯一性和排它性。但互斥无法限制访问者对资源的访问顺序，即访问是无序的。某种意义上说互斥是一种制约关系更小的同步。

3.2、线程间的同步方式
1、临界区(Critical section)
保证在某一时刻只有一个线程能访问数据的简便办法。在任意时刻只允许一个线程对共享资源进行访问。如果有多个线程试图同时访问临界区，那么 在有一个线程进入后其他所有试图访问此临界区的线程将被挂起，并一直持续到进入临界区的线程离开。临界区在被释放后，其他线程可以继续抢占，并以此达到用原子方式操 作共享资源的目的。

2、互斥量（Mutex）
互斥量跟临界区很相似，只有拥有互斥对象的线程才具有访问资源的权限，由于互斥对象只有一个，因此就决定了任何情况下此共享资源都不会同时被多个线程所访问。当前占据资源的线程在任务处理完后应将拥有的互斥对象交出，以便其他线程在获得后得以访问资源。互斥量比临界区复杂。因为使用互斥不仅仅能够在同一应用程序不同线程中实现资源的安全共享，而且可以在不同应用程序的线程之间实现对资源的安全共享。

3、信号量(Semaphore)
信号量对象对线程的同步方式与前面几种方法不同，信号允许多个线程同时使用共享资源 ，这与操作系统中的PV操作相同。它指出了同时访问共享 资源的线程 最大数目。它允许多个线程在同一时刻访问同一资源，但是需要限制在同一时刻访问此资源的最大线程数目。在用CreateSemaphore（）创建信号量 时即要同时指出允许的最大资源计数和当前可用资源计数。一般是将当前可用资源计数设置为最大资源计数，每增加一个线程对共享资源的访问，当前可用资源计数 就会减1，只要当前可用资源计数是大于0的，就可以发出信号量信号。但是当前可用计数减小到0时则说明当前占用资源的线程数已经达到了所允许的最大数目， 不能在允许其他线程的进入，此时的信号量信号将无法发出。线程在处理完共享资源后，应在离开的同时通过ReleaseSemaphore（）函数将当前可 用资源计数加1。在任何时候当前可用资源计数决不可能大于最大资源计数。
PV操作及信号量的概念都是由荷兰科学家E.W.Dijkstra提出的。信号量S是一个整数，S大于等于零时代表可供并发进程使用的资源实体数，但S小于零时则表示正在等待使用共享资源的进程数。
P操作 申请资源：
　　（1）S减1；
　　（2）若S减1后仍大于等于零，则进程继续执行；
　　（3）若S减1后小于零，则该进程被阻塞后进入与该信号相对应的队列中，然后转入进程调度。
V操作 释放资源：
　　（1）S加1；
　　（2）若相加结果大于零，则进程继续执行；
　　（3）若相加结果小于等于零，则从该信号的等待队列中唤醒一个等待进程，然后再返回原进程继续执行或转入进程调度。

4、事件（Event）
事件对象也可以通过通知操作的方式来保持线程的同步。并且可以实现不同进程中的线程同步操作。

3.3、区别与联系
以上四种同步方式

3.3.1、按操作系统可分为
在Windows系统中：临界区（Critical Section）和事件对象(Event)是常用的同步方法；
在类Unix系统中：互斥量（Mutex）和 信号量(Semaphore)是常用的同步方法；

3.3.2、按同步底层操作对象可分为
用户对象的线程同步：临界区(Critical section) （特点是同步速度特别快，适合于对线程运行速度有严格要求的场合）；
内核对象的线程同步： 互斥量（Mutex）、信号量(Semaphore) 和 事件（Event）（内核对象的同步机制使用了内核对象，使用时必须将线程从用户模式切换到内核模式，而这种转换一般要耗费近千个CPU周期，因此同步速度较慢，但在适用性上却要远优于用户模式的线程同步方式）。

3.3.3、按是否可跨进程分为
可跨进程同步方式：互斥量、信号量、事件
不可跨进程同步方式：临界区

3.3.4、按同步和互斥的关系分为
主要用于互斥控制：临界区（Critical Section）、互斥对象（Mutex）
主要用于同步控制：信号量（Semaphore）、事件对象（Event）

4、进程
4.1、进程的基本概念
进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。在早期面向进程设计的计算机结构中，进程是程序的基本执行实体；在当代面向线程设计的计算机结构中，进程是线程的容器。程序是指令、数据及其组织形式的描述，进程是程序的实体。

(1)、进程是一个实体
每一个进程都有它自己的地址空间，一般情况下，包括文本区域（text region）、数据区域（data region）和堆栈（stack region）。文本区域存储处理器执行的代码；数据区域存储变量和进程执行期间使用的动态分配的内存；堆栈区域存储着活动过程调用的指令和本地变量。

(2)、进程是一个“执行中的程序”
程序是一个没有生命的实体（程序是指令、数据及其组织形式的描述），只有处理器赋予程序生命时（操作系统执行之），它才能成为一个活动的实体，我们称其为进程。

5、进程和线程的关系及区别
5.1、关系
（1）一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程；
（2）资源分配给进程，同一进程的所有线程共享该进程的所有资源；
（3）处理机分给线程，即真正在处理机上运行的是线程；
（4）线程在执行过程中，需要协作同步。不同进程的线程间要利用消息通信的办法实现同步。线程是指进程内的一个执行单元,也是进程内的可调度实体。

5.2、区别
（1）调度：进程是资源的拥有者，线程是资源的调度者；
（2）并发性：不仅进程之间可以并发执行，同一个进程的多个线程之间也可并发执行；
（3）拥有资源：进程是拥有资源的一个独立单位，线程不拥有系统资源，但可以访问隶属于进程的资源；
（4）系统开销：在创建或撤消进程时，由于系统都要为之分配和回收资源，导致系统的开销明显大于创建或撤消线程时的开销。
（5）进程就是包括上下文切换的程序执行时间总和 = CPU加载上下文+CPU执行+CPU保存上下文，线程是共享了进程的上下文环境的更为细小的CPU时间段。

6、进程间通信方式——IPC(Inter-Process Communication)
根据进程通信时信息量大小的不同,可以将进程通信划分为两大类型

6.1、低级通信———控制信息的通信
主要用于进程之间的同步、互斥、终止和挂起等等控制信息的传递；

1、信号 ( signal ) ： 信号是一种比较复杂的通信方式，**用于通知接收进程某个事件已经发生。**除了进程间通信外，进程还可以发送信号给进程本身；linux除了支持Unix早期信号语义函数sigal外，还支持语义符合Posix.1标准的信号函数sigaction。

2、信号量( semophore ) ： **信号量是一个计数器，可以用来控制多个进程对共享资源的访问。不是用于交换大批数据,而用于多线程之间的同步.**常作为一种锁机制,防止某进程在访问资源时其它进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。

6.2、高级通信———大批数据信息的通信
主要用于进程间数据块数据的交换和共享

3、管道( pipe )：管道是一种半双工的通信方式，数据只能单向流动，而且只能在具有亲缘关系的进程间使用。进程的亲缘关系通常是指父子进程关系。

4、有名管道 (named pipe) ： 有名管道也是半双工的通信方式，但是它允许无亲缘关系进程间的通信。

5、消息队列( message queue ) ： 消息队列是消息的链接表，包括Posix消息队列和System V消息队列。有足够权限的进程可以向队列中添加消息，被赋予读权限的进程则可以读走队列中的消息。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。

6、共享内存( shared memory ) ：共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的 IPC 方式，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号量，配合使用，来实现进程间的同步和通信。

7、套接字( socket ) ： 套解字也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同机器间的进程通信。

8、内存映射（mapped memory）：内存映射允许任何多个进程间通信，每一个使用该机制的进程通过把一个共享的文件映射到自己的进程地址空间来实现它。