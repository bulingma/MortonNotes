
<!-- TOC -->

- [第3章 Linux存储栈](#第3章-linux存储栈)
  - [3.1 Linux存储系统概述](#31-linux存储系统概述)
  - [3.2 系统调用](#32-系统调用)
  - [3.3 文件系统](#33-文件系统)
    - [3.3.1 文件系统概述](#331-文件系统概述)
    - [3.3.2 Btrfs](#332-btrfs)
  - [3.4 Page Cache](#34-page-cache)
  - [3.5 Direct I/O](#35-direct-io)
  - [3.6 块层(Block Layer)](#36-块层block-layer)
  - [3.7 LVM](#37-lvm)
  - [3.8 bcache](#38-bcache)
  - [3.9 DRBD](#39-drbd)

<!-- /TOC -->

# 第3章 Linux存储栈  

如果把整个Linux系统看成各种数据共生的世界，那么它的存储系 统要完成的就是为这些数据寻找或分配一个家，从而做到“居者有其屋”，这个过程必然是复杂而又严谨的，这也是我们基于Linux展开的一切与存储相关的讨论的基础。

## 3.1 Linux存储系统概述
如图3-1所示，宽泛一点来说，Linux存储系统包括两个部分:  
第一部分是站在用户的角度提供读/写的接口，数据以流为表现形式;  
第二部分是站在存储设备的角度提供读/写接口，数据以块为表现形式。  
文件系统位于两者中间起到承上启下的作用。

![图3-1：Linux-storage-stack-diagram_v4.10](../../../z_images/my_notes/Linux-storage-stack-diagram_v4.10.png)

## 3.2 系统调用
用户应用程序访问并使用内核所提供的各种服务的途径即是系统调用。在内核和用户应用程序相交的地方，内核提供了一组系统调用接口，通过这组接口，应用程序可以访问系统硬件和各种操作系统资源。用户可以通过文件系统相关的系统调用请求系统打开文件、关闭文件或 读/写文件。例如，可以通过时钟相关的系统调用获得系统时间或设置定时器等。  

内核提供的这组系统调用通常也被称为系统调用接口层。系统调用接口层作为内核和用户应用程序之间的中间层，扮演了一个中间人的角色。系统调用接口把应用程序的请求传达给内核，待内核处理完请求后再将处理结果返回给应用程序。

内核提供的系统调用数目非常有限，其中，图3-1中与存储系统相关的主要就是read、write、open等，这里着重介绍一下很容易产生各种误解的mmap。

## 3.3 文件系统
### 3.3.1 文件系统概述
### 3.3.2 Btrfs  
## 3.4 Page Cache
## 3.5 Direct I/O
## 3.6 块层(Block Layer)
## 3.7 LVM
## 3.8 bcache
## 3.9 DRBD